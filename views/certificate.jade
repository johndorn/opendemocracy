extend layout
block custom_script
	script(type='text/javascript')
		$(document).ready(function(){
			var certificate_id = '#{user_certificate.id}';
			$('#delete_certificate').click(function(e) {
				if( ! certificate_id )
					return false;
				$.ajax('/certificate/' + certificate_id, {
					type: 'DELETE',
					success: function(data) {
						var d = JSON.parse(data);
						$('.certificate').hide();
						$('.no-certificate').show();
					},
					error: function(data) {
						var d = JSON.parse(data);
						alert('Error deleting certificate. ' + data.error_msg);
					}
				});
			});
			$('#add_certificate').click(function(e) {
				$.ajax('/certificate/new', {
					type: 'PUT',
					success: function(data) {
						var d = JSON.parse(data);
						certificate_id = d.cert.id;
						$('.certificate').show();
						$('.no-certificate').hide();
					},
					error: function(data) {
						var d = JSON.parse(data);
						alert('Error deleting certificate. ' + data.error_msg);
					}
				});
			});
		});

block content
	.certificate-container
		- var hide_class = user_certificate ? '' : 'hide';
		div(class="certificate " + hide_class)
			p
				| Current Stored Certificate Information
			p.subheading
				| To remove this certificate click
				input(type="button", id="delete_certificate", value="Remove this certificate")
			dl(class="certificate-content", id="certificate-content")
				if ! Object.keys(user_certificate).length
					- user_certificate.subject = {};
					- user_certificate.issuer = {};
				dt Certificate ID
				dd #{user_certificate.id}
				dt Subject Common Name
				dd #{user_certificate.subject.CN}
				dt Issuer Common Name
				dd #{user_certificate.issuer.CN}
				dt Fingerprint
				dd #{user_certificate.fingerprint}
				dt Valid Start
				dd #{user_certificate.valid_from}
				dt Valid End
				dd #{user_certificate.valid_to}
		.no-certificate
			p
				| No Stored Certificate Found
				input(type="button", id="add_certificate", value="Add installed certificate")

